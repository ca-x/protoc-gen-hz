layouts:
  # 覆盖默认 router.go 模板
  # 关键：将 Register 函数名改为包含服务名的唯一名称
  - path: router.go
    delims: ['{{', '}}']
    body: |-
      // Code generated by hertz generator. DO NOT EDIT.

      package {{$.PackageName}}

      import (
          "github.com/cloudwego/hertz/pkg/app/server"

      {{- range $k, $v := .HandlerPackages}}
          {{$k}} "{{$v}}"
      {{- end}}
      )

      /*
       This file will register all the routes of the services in the master idl.
       And it will update automatically when you use the "update" command for the idl.
       So don't modify the contents of the file, or your code will be deleted when it is updated.
      */

      {{define "g"}}
      {{- if eq .Path "/"}}r
      {{- else}}{{.GroupName}}{{end}}
      {{- end}}

      {{define "G"}}
      {{- if ne .Handler ""}}
          {{- .GroupName}}.{{.HttpMethod}}("{{.Path}}", append({{.HandlerMiddleware}}Mw(), {{.Handler}})...)
      {{- end}}
      {{- if ne (len .Children) 0}}
      {{.MiddleWare}} := {{template "g" .}}.Group("{{.Path}}", {{.GroupMiddleware}}Mw()...)
      {{- end}}
      {{- range $_, $router := .Children}}
      {{- if ne .Handler ""}}
          {{template "G" $router}}
      {{- else}}
          {	{{template "G" $router}}
          }
      {{- end}}
      {{- end}}
      {{- end}}

      // Register register routes based on the IDL 'api.${HTTP Method}' annotation.
      func Register(r *server.Hertz) {
      {{template "G" .Router}}
      }

  # 覆盖 register.go 模板
  # 在这个文件中聚合所有服务的 Register 调用
  - path: register.go
    delims: ['{{', '}}']
    update_behavior:
      type: "append"
      append_key: "service"
      insert_key: "{{.ServiceName}}"
      append_tpl: |
        {{$.DepPkgAlias}}.Register(r)
    body: |-
      // Code generated by hertz generator. DO NOT EDIT.

      package {{.PackageName}}

      import (
          "github.com/cloudwego/hertz/pkg/app/server"
          {{$.DepPkgAlias}} "{{$.DepPkg}}"
      )

      // GeneratedRegister registers routers generated by IDL.
      func GeneratedRegister(r *server.Hertz){
          //INSERT_POINT: DO NOT DELETE THIS LINE!
          {{$.DepPkgAlias}}.Register(r)
      }
